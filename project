// This #include statement was automatically added by the Particle IDE.
#include <BH1750Lib.h>

#define PIN_TRIG  D5
#define PIN_ECHO D6
#define LED D7
#define Buzzer D3

int Alert = 0;
bool sunrise = false;
BH1750Lib lightSensor;


void detect()
{
    
    long runTime, distance;
    digitalWrite(PIN_TRIG, LOW);
    delayMicroseconds(2);
    digitalWrite(PIN_TRIG, HIGH);
    delayMicroseconds(10);
    digitalWrite(PIN_TRIG, LOW);
    
    runTime = pulseIn(PIN_ECHO, HIGH);
    distance = runTime/2/29;
    
   
    if(distance <= Alert)
    {
        
        digitalWrite(LED, HIGH);
        delay(250ms);
    
        digitalWrite(LED, LOW);
        delay(250ms);
        
        digitalWrite(Buzzer, LOW);
        delay(200);
    }   
}

void setup() 
{
    
  Serial.begin(9600);
  lightSensor.begin(BH1750LIB_MODE_CONTINUOUSHIGHRES);
  
  pinMode(PIN_TRIG, OUTPUT);
  pinMode(PIN_ECHO, INPUT);
  pinMode(Buzzer, OUTPUT);
  pinMode(LED, OUTPUT);
  
}

void loop() 
{
    
    uint16_t lightlevel = lightSensor.lightLevel();
        
    if (lightlevel >= 100 && sunrise == false)
    {
        sleep = true;
        digitalWrite(Buzzer, HIGH);
        Alert = 0;
    }
    else if (lightlevel < 100 && sunrise == true)
    {
        sleep = false;
        Alert = 20;
    }
    
    detect();
    
}
